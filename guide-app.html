<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<style>
    .demo-alert-box {
        padding: 10px 20px;
        background: #f3beb8;
        border: 1px solid #f09898;
    }
    .tab-button {
        padding: 6px 10px;
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;
        border: 1px solid #ccc;
        cursor: pointer;
        background: #f0f0f0;
        margin-bottom: -1px;
        margin-right: -1px;
    }
    .tab-button:hover {
        background: #e0e0e0;
    }
    .tab-button.active {
        background: #e0e0e0;
    }
    .tab {
        border: 1px solid #ccc;
        padding: 10px;
    }
</style>
<body>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <div id="app-4">
        <ol>
            <li v-for="todo in todos">
                {{ todo.text }}
            </li>
        </ol>
    </div>
    <script>
        var app4 = new Vue({
            el: '#app-4',
            data: {
                todos: [
                {text: 'program 1'},
                {text: 'program 2'},
                {text: 'program 3'}
                ]
            }
        })
    </script>
    
    <hr>
    <div id="app-5">
        <p>{{ message }}</p>
        <button v-on:click="reverseMessage">Reverse</button>
    </div>
    <script>
        var app5 = new Vue({
            el: '#app-5',
            data: {
                message: 'Hello Vue.js!'
            },
            methods: {
                reverseMessage: function() {
                    this.message = this.message.split('').reverse().join('')
                }   
            }
        })
    </script>
    
    <hr>
    <div id="app-6">
        <p>{{ message }}</p>
    </div>
    <input v-model="message">
    <script>
        var app6 = new Vue({
            el: '#app-6',
            data: {
                message: 'Hello Vue.js!'
            }
        })
    </script>
    
    <hr>
    <div id="app-7">
        <todo-item 
        v-for="item in groceryList"
        v-bind:todo="item"
        v-bind:key="item.id"
        >
    </todo-item>
</div>
<script>
    Vue.component('todo-item', {
        props: ['todo'],
        template: '<li>{{ todo.text }}</li>'
    })
    var app7 = new Vue({
        el: '#app-7',
        data: {
            groceryList: [
            { id: 0, text: '蔬菜'},
            { id: 1, text: '奶酪'},
            { id: 2, text: '其他'}
            ]
        }
    })
</script>

<hr>
<div id="computedDemo1">
    <p>Reverse message by computed-prop: {{ message }}</p>
    <p>Reverse message by methonds: {{ reverseMessage() }}</p>
    <input v-model="message">
    <button v-on:click="reverseMessage">reverse</button>
</div>
<script>
    var computedDemo1 = new Vue({
        el: '#computedDemo1',
        data: {
            message: 'Hello Vue.js !'
        },
        computed: {
            reverseMessage: function() {
                return this.message.split('').reverse().join('')
            }
        },
        methods: {
            reverseMessage: function() {
                return this.message.split('').reverse().join('')     
            }
        }
    }) 
</script>

// 用 watch 与 computed 观察与响应 Vue 实例上的数据变动 

<hr>
<div id="watchDemo1">
    <p> {{ fullName }} </p>
</div>
<script>
    var watchDemo1 = new Vue({
        el: '#watchDemo1',
        data: {
            firstName: 'foo',
            lastName: 'Bar',
            fullName: 'foo Bar'
        },
        watch: {
            firstName: function(val) {
                this.fullName = val + ' ' + this.lastName;
            },
            lastName: function(val) {
                this.fullName = this.firstName + ' ' + val;
            }
        }
    })
</script>


//  为 computed 定义 setter (默认只有 getter 方法) 
<hr>
<div id="computedDemo2">
    <p> {{ fullName }} </p>
</div>
<script>
    var computedDemo2 = new Vue({
        el: '#computedDemo2',
        data: {
            firstName: 'foo',
            lastName: 'Bar',
            fullName: 'foo Bar'
        },
        computed: {
            fullName1: {
                get: function() {
                    return this.firstName + ' ' + this.lastName
                },
                set: function(newVal) {
                    var names = newVal.split(' ')
                    this.firstName = names[0]
                    this.lastName = names[names.length - 1]
                }
            }
        }
    })
</script>

// 
<hr>
<div id="watchDemo2">
    <p>Ask a yes/no quetion</p>
    <input v-model="question">
    <p >{{answer}}</p>
</div>
// 使用基于 promise 的 HTTP 客户端 axios 
<script src="https://cdn.jsdelivr.net/npm/axios@0.12.0/dist/axios.min.js"></script>
// 通过 Lodash 限制操作频率
<script src="https://cdn.jsdelivr.net/npm/lodash@4.13.1/lodash.min.js"></script>
<script>
    var watchDemo2 = new Vue({
        el: '#watchDemo2',
        data: {
            question: '', 
            answer: 'I cannot give you an answer until you ask a question!'
        },
        created: function () {
            this.debouncedGetAnswer = _.debounce(this.getAnswer, 500)
        },
        watch: {
            question: function () {
                this.answer = 'Waiting for you to stop typing...'
                this.debouncedGetAnswer()
            }
        },
        methods: {
            getAnswer: function () {
                if (this.question.indexOf('?') != -1) {
                    this.answer = 'Questions usually contain a question mark. ;-)'
                    return ;
                }
                var vm = this
                this.answer = 'thinking'
                axios.get('https://yesno.wtf/api')
                .then(function(response) {
                    vm.answer = _.capitalize(response.data.answer)
                })
                .catch(function(error) {
                    vm.answer = 'Error! Could not reach the API. ' + error
                })
            }
        }
    })
</script>
<hr>
<div id="computedDemo3">
    <p>first name: <input v-model="firstName"></p>
    <p>last name: <input v-model="lastName"></p>
    <p>full name(单向 computed): <input v-model="fullname1"></p>
    <p>full name(单向 watch): <input v-model="fullnameByWatched"></p>
    <p>full name(双向): <input v-model="fullname3"></p>
</div>
<script>
    var computedDemo3 = new Vue({
        el: '#computedDemo3',
        data: {
            firstName: 'AB',
            lastName: 'C', 
            fullnameByWatched: ''
        },
        computed: {
            fullname1: function () {
                return this.firstName + ' ' + this.lastName
            },
            fullname3: {
                get() {
                    return this.firstName + ' ' + this.lastName
                },
                set(value) {
                    const names = value.split(' ')
                    this.firstName = names[0]
                    this.lastName = names[1]
                }
            }
        },
        watch: {
            firstName: function (oldValue, newValue) {
                this.fullnameByWatched = newValue + ' ' + this.lastName
            }
        }
    })
</script>

<h1>v-if</h1>
<hr>
<div id="vifDemo" >
    
</div>

<h1>v-for</h1>
<hr>
<h2>迭代数组</h2>
<ul id="v-for-array">
    // 可以访问父作用域的属性
    <li v-for="(item, index) in items">
        {{ parentMessage }} -- {{ index }} -- {{ item.message}}
    </li> 
    
    <hr>
    // 更符合 JavaScript 的语法 of
    <li v-for="(item, index) of items" :key="item.id">
        {{ parentMessage }} -- {{ index }} -- {{ item.message}} -- {{ item.id }}
    </li>
</ul>
<script>
    var example1 = new Vue({
        el: '#v-for-array',
        data: {
            parentMessage: 'Parent',
            items: [
            { id: 111, message: 'Foo' },
            { id: 222, message: 'Bar'}
            ]
        }
    })
    // example1.items.push({ id: 333,   message: 'Baz' })
</script>
<h2>迭代对象</h2>
<ul id="v-for-object">
    <li v-for="(value, key, index) in object">
        {{ index }}. {{ key }} : {{ value}}
    </li>
</ul>
<script>
    var vforObject = new Vue({
        el: '#v-for-object',
        data: {
            object: {
                firstName: 'Taylor',
                lastName: 'Swift'
            }
        }
    })
    // 错误
    // vm.object.fullName = 'xxx' 
    // Vue.set(vforObject.object, 'age', 30)
</script>
<h2>过滤</h2>
<p>even numbers: 
    <ul id="v-for-filter">
        <li v-for="n in evenNumbers">
            {{n}}
        </li>
    </ul>
</p>
<script>
    new Vue({
        el: '#v-for-filter',
        data: {
            numbers: [1, 2, 3, 4, 5, 6]
        },
        computed: {
            evenNumbers: function () {
                return this.numbers.filter(function (number) {
                    return number % 2 == 0
                })
            }
        }
    })
</script>
<p>Odd numbers: 
    <ul id="v-for-filter1">
        <li v-for="n in odd(numbers)">
            {{ n }}
        </li>
    </ul>
</p>

<script>
    new Vue({
        el: '#v-for-filter1',
        data: {
            numbers: [1, 2, 3, 4, 5, 6]
        },
        methods: {
            odd: function (numbers) {
                return numbers.filter(function (number) {
                    return number % 2 == 1
                })
            }
        }
    })
</script>
<h1>事件处理</h1>
<h2>使用 on 监听事件</h2>
<div id="event-demo-1">
    <button v-on:click="counter += 1">Add 1</button>
    <p>The button above has been clicked {{ counter }} times.</p>
</div>
<script>
    var eventDemo1 = new Vue({
        el: '#event-demo-1',
        data: {
            counter: 0
        }
    })
</script>
<h2>处理更加复杂的逻辑</h2>
<h2>事件</h2>
<div id="event-demo-2">
    <!-- 无参数 -->
    <button v-on:click="greet">Greet</button>
    <!-- 传入一个 String 参数和对应的原始的 DOM 事件 -->
    <button v-on:click="warn('Form cannot be submitted yet.', $event)">Submit</button>
</div>
<script>
    var event1 = new Vue({
        el: '#event-demo-2',
        data: {
            name: 'Vue.js'
        },
        methods: {
            greet: function (event) {
                // `this` 在方法里指向当前 Vue 实例
                alert('Hello ' + this.name + '!')
                // `event` 是原生 DOM 事件
                if (event) {
                    alert(event.target.tagName)
                }
            },
            warn: function (message, event) {
                if (event) event.preventDefault()
                alert(message)
            }
        }
    })
</script>
<p id="v-on-event2">
    事件修饰符
    <!-- 阻止单击事件继续传播 -->
    <a v-on:click.stop="doThis"></a>
    
    <!-- 提交事件不再重载页面 -->
    <form v-on:submit.prevent="onSubmit"></form>
    
    <!-- 修饰符可以串联 -->
    <a v-on:click.stop.prevent="doThat"></a>
    
    <!-- 只有修饰符 -->
    <form v-on:submit.prevent></form>
    
    <!-- 添加事件监听器时使用事件捕获模式 -->
    <!-- 即元素自身触发的事件先在此处理，然后才交由内部元素进行处理 -->
    <div v-on:click.capture="doThis">...</div>
    
    <!-- 只当在 event.target 是当前元素自身时触发处理函数 -->
    <!-- 即事件不是从内部元素触发的 -->
    <div v-on:click.self="doThat">...</div>
</p>
<p id="v-on-event3">
    按键修饰符
    <!-- 只有在 `key` 是 `Enter` 时调用 `vm.submit()` -->
    <input v-on:keyup.enter="submit">
    <!-- Vue 提供了绝大多数常用的按键码的别名：
        .enter
        .tab
        .delete (捕获“删除”和“退格”键)
        .esc
        .space
        .up
        .down
        .left
        .right 
    -->
</p>
<h1>组件基础</h1>
<div id="componentsDemo">
    <button-counter></button-counter>
    <button-counter></button-counter>
    <button-counter></button-counter>    
</div>
<script>
    //  Vue.component 全局注册
    Vue.component('button-counter', {
        // data 必须是一个函数
        data: function () {
            return {
                count: 0
            }
        },
        template: '<button v-on:click="count++">You clicked me {{ count }} times. </button>'
    })
    new Vue({
        el: '#componentsDemo'
    })
</script>
<h2>通过 Prop 向子组件传递数据        </h2>
<div id="blog-post-demo1">
    <blog-post-1 title="Blogging with Vue"></blog-post-1>
    <blog-post-1 title="My journey with Vue"></blog-post-1>
    <blog-post-1 title="Why Vue is so fun"></blog-post-1>
</div>
<script>
    Vue.component('blog-post-1', {
        props: ['title'],
        template: '<h3> {{ title }} </h3>'
    })
    var u = new Vue({
        el: '#blog-post-demo1'
    })
</script>
<p>
    <div id="blog-post-demo2">
        <blog-post-2
        v-for="post in posts"
        v-bind:key="post.id"
        v-bind:title="post.title"
        ></blog-post-2>
    </div>
</p>
<script>
    Vue.component('blog-post-2', {
        props: ['title'],
        template: '<p> {{ title }} </p>'
    })
    new Vue({
        el: '#blog-post-demo2',
        data: {
            posts: []
        },
        created: function () {
            // Alias the component instance as `vm`, so that we  
            // can access it inside the promise function
            var vm = this
            // Fetch our array of posts from an API
            fetch('https://jsonplaceholder.typicode.com/posts')
            .then(function (response) {
                return response.json()
            })
            .then(function (data) {
                vm.posts = data
            })
        }
    })
</script>

<h2>单个根元素</h2>
<div id="blog-post-3">
    <blog-post-3
    v-bind:post="post"
    :key="post.id"
    ></blog-post-3>
</div>
<script>
    Vue.component('blog-post-3', {
        props: ['post'],
        template: `
        <div class="blog-post-3">
            <h3> {{ post.title }}-{{ post.id }}</h3>
            <div v-html="post.content"></div>
        </div>
        `
    })
    new Vue({
        el: '#blog-post-3',
        data: {
            post: {
                id: 1,
                title: 'post',
                content: '<p>post.content</p>'
            }
        }
    })
</script>
<h2>监听子组件事件</h2>
<div id="blog-post-event">
    <div :style="{ fontSize: postFontSize + 'em' }">
        <blog-post-event
        v-for="post of posts"
        :key="post.id"
        :post="post" 
        v-on:enlarge-text="postFontSize += 0.1"
        ></blog-post-event>
    </div>
</div>
<script>
    Vue.component('blog-post-event', {
        props: ['post'],
        template: `
        <div class="blog-post-3">
            <h3> {{ post.title }}-{{ post.id }}</h3>
            <button v-on:click="$emit(\'enlarge-text\')">Enlarge text</button>
            <div v-html="post.content"></div>
        </div>        `
    })
    new Vue({
        el: '#blog-post-event',
        data: {
            posts: [
            { id: 1, title: 'post', content: '<p>psot.content</p>'},
            { id: 2, title: 'post', content: '<p>psot.content</p>'},
            { id: 3, title: 'post', content: '<p>psot.content</p>'}
            ],
            postFontSize: 1
        }
    })
</script>
<h2>使用事件抛出一个值</h2>
<div id="blog-post-event-1">
    <div :style="{ fontSize : postFontSize + 'em'}">
        <blog-post-4
        v-for="post of posts"
        :key="post.id"
        :post="post"
        v-on:enlarge-text="onEnlargeText"
        ></blog-post-4>
    </div>
</div>
<script>
    Vue.component('blog-post-4', {
        props: ['post'],
        template: ` 
        <div class="blog-post-3">
            <h3> {{ post.title }}-{{ post.id }}</h3>
            <button v-on:click="$emit(\'enlarge-text\', 0.1)">Enlarge text</button>
            <div v-html="post.content"></div>
        </div>        `
    })
    new Vue({
        el: '#blog-post-event-1',
        data: {
            posts: [
            { id: 1, title: 'post', content: '<p>psot.content</p>'},
            { id: 2, title: 'post', content: '<p>psot.content</p>'},
            { id: 3, title: 'post', content: '<p>psot.content</p>'}
            ],
            postFontSize: 1
        },
        methods: {
            onEnlargeText: function (enlargeAmount) {
                this.postFontSize += enlargeAmount
            }
        }
    })
</script>
<h2>组件上使用 v-model</h2>
<div id="v-model-demo">
    <custom-input v-model="searchText"></custom-input>
    {{ searchText}}
</div>
<script>
    Vue.component('custom-input', {
        props: ['value'],
        template: `
        <input
        v-bind:value="value"
        v-on:input="$emit('input', $event.target.value)"
        ></input>
        `
    })
    new Vue({
        el: '#v-model-demo',
        data: {
            searchText: ''
        }
    })
</script>
<h2>通过插槽分发内容    </h2>
<div id="slot-demo">
    <alert-box></alert-box>
</div>
<script>
    Vue.component('alert-box',{
        template: `
        <div class="demo-alert-box">
            <strong>Error ! </strong>
            <slot></slot>
        </div>
        `
    })
    new Vue({
        el:'#slot-demo'
    })
</script>
<h2>动态组件</h2>
<div id="dynamic-component-demo" class="demo">
    <button
    v-for="tab in tabs"
    v-bind:key="tab"
    v-bind:class="['tab-button', { active: currentTab === tab }]"
    v-on:click="currentTab = tab"
    >{{ tab }}</button>
    
    <component
    v-bind:is="currentTabComponent"
    class="tab"
    ></component>
</div>
<script>
    Vue.component('tab-home', { 
        template: '<div>Home component</div>' 
    })
    Vue.component('tab-posts', { 
        template: '<div>Posts component</div>' 
    })
    Vue.component('tab-archive', { 
        template: '<div>Archive component</div>' 
    })
    new Vue({
        el: '#dynamic-component-demo',
        data: {
            currentTab: 'Home',
            tabs: ['Home', 'Posts', 'Archive']
        },
        computed: {
            currentTabComponent: function () {
                return 'tab-' + this.currentTab.toLowerCase()
            }
        }
    })
</script>
</body>
</html>
